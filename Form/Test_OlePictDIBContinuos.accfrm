Version =20
VersionRequired =20
Checksum =1043896095
Begin Form
    AutoCenter = NotDefault
    KeyPreview = NotDefault
    AllowDesignChanges = NotDefault
    TabularCharSet =204
    TabularFamily =119
    PictureAlignment =2
    DatasheetGridlinesBehavior =3
    GridY =10
    Width =6804
    DatasheetFontHeight =10
    ItemSuffix =28
    Left =8925
    Top =1695
    Right =16020
    Bottom =8835
    DatasheetGridlinesColor =12632256
    RecSrcDt = Begin
        0x05b9ed8795c5e540
    End
    GUID = Begin
        0x5ccae17007ff8548af2e725d870463fd
    End
    NameMap = Begin
        0x0acc0e55000000004e8ac1030283e644a3b4b80db88f803d0000000018c75bb1 ,
        0x4e1ce64000000000000000005300790073004400690062005000690063007400 ,
        0x7500720065007300000000000000e82be582d8936b459fb2276b6dd999d90600 ,
        0x00005ccae17007ff8548af2e725d870463fd43006f006c006f00720049006400 ,
        0x000000000000622d835820d8f14b99dbf79c270f743b070000004e8ac1030283 ,
        0xe644a3b4b80db88f803d4400690062004900640000000000000006f0d7d9a7e5 ,
        0xcd4a96b26f75df60dbb6070000004e8ac1030283e644a3b4b80db88f803d4300 ,
        0x6f006d006d0065006e0074000000000000008be656fb1e99c54193effa4680f7 ,
        0x0d34060000005ccae17007ff8548af2e725d870463fd74007800740044006900 ,
        0x6200490064000000000000008b3241ced19c1743ac92f3e496b5600607000000 ,
        0x4e8ac1030283e644a3b4b80db88f803d53007400720049006400000000000000 ,
        0xdfcb90546d285845b36384ecbdd38890070000004e8ac1030283e644a3b4b80d ,
        0xb88f803d43004e0061006d006500000000000000000000000000000000000000 ,
        0x000000000c000000050000000000000000000000000000000000
    End
    RecordSource ="SysDibPictures"
    Caption ="SysDibPictures"
    OnCurrent ="[Event Procedure]"
    OnOpen ="[Event Procedure]"
    OnClose ="[Event Procedure]"
    DatasheetFontName ="Arial"
    PrtMip = Begin
        0xae050000a5050000a5050000a505000000000000201c0000e010000001000000 ,
        0x010000006801000000000000a10700000100000001000000
    End
    PrtDevMode = Begin
        0x0000000000000000386af4070000000020569e33f77f0000335c3f33f77f0000 ,
        0x0104220b9c006c01036e07000100090000000000640001000100580202000100 ,
        0x580202000000413400ad0d0500000000feffffffffffffff25dd0d41fe7f0000 ,
        0xc0c0c00000005802180000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000046500800 ,
        0x4d53414343455353000000000000000000000000000000000000000000000000 ,
        0xff3e03005802aa00ac00aa00ac00010000003100436f7572696572204e657700 ,
        0x0000000000000000000000000000000000000000010001000200000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000009600 ,
        0x4b002c0100800000
    End
    PrtDevNames = Begin
        0x080015001f000100000000000000000000000000000000000000000000000046 ,
        0x505231313a00
    End
    OnKeyDown ="[Event Procedure]"
    OnResize ="[Event Procedure]"
    OnLoad ="[Event Procedure]"
    UnknownProp = {305 ,452 ,1 ,1 ,1 } Begin
        0x00
    End
    UnknownProp = {400 ,582 ,4 ,4 ,4 } Begin
        0xc0c0c000
    End
    UnknownProp = {419 ,678 ,11 ,0 ,584 } Begin
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0104220bdc006c01036e07000100090000000000640001000100580202000100 ,
        0x5802020000004100340000000000000009031000000000000000000000000000 ,
        0x5002000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000005802180000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000046500800 ,
        0x4d53414343455353000000000000000000000000000000000000000000000000 ,
        0xff3e03005802aa00ac00aa00ac00010000003100436f7572696572204e657700 ,
        0x0000000000000000000000000000000000000000010001000200000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000009600 ,
        0x4b002c0100800000
    End
    UnknownProp = {420 ,679 ,11 ,0 ,68 } Begin
        0x040011001b000100000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000046005000520031003100 ,
        0x3a000000
    End
    Begin
        Begin Label
            BackStyle =0
            TextFontCharSet =204
            BackColor =-2147483633
            ForeColor =-2147483630
        End
        Begin Rectangle
            SpecialEffect =3
            BackStyle =0
            BorderLineStyle =0
            Width =850
            Height =850
        End
        Begin Line
            BorderLineStyle =0
            Width =1701
        End
        Begin Image
            BackStyle =0
            OldBorderStyle =0
            BorderLineStyle =0
            PictureAlignment =2
            Width =1701
            Height =1701
        End
        Begin CommandButton
            TextFontCharSet =204
            Width =1701
            Height =283
            FontSize =8
            FontWeight =400
            FontName ="MS Sans Serif"
            UnknownProp = {324 ,11 ,2 ,1 ,1 } Begin
                0x00
            End
        End
        Begin OptionButton
            SpecialEffect =2
            BorderLineStyle =0
            LabelX =230
            LabelY =-30
        End
        Begin CheckBox
            SpecialEffect =2
            BorderLineStyle =0
            LabelX =230
            LabelY =-30
        End
        Begin OptionGroup
            SpecialEffect =3
            BorderLineStyle =0
            Width =1701
            Height =1701
        End
        Begin BoundObjectFrame
            SpecialEffect =2
            OldBorderStyle =0
            BorderLineStyle =0
            BackStyle =0
            Width =4536
            Height =2835
            LabelX =-1701
        End
        Begin TextBox
            FELineBreak = NotDefault
            SpecialEffect =2
            TextFontCharSet =204
            BorderLineStyle =0
            Width =1701
            LabelX =-1701
            BackColor =-2147483643
            ForeColor =-2147483640
            AsianLineBreak =255
        End
        Begin ListBox
            SpecialEffect =2
            TextFontCharSet =204
            BorderLineStyle =0
            Width =1701
            Height =1417
            LabelX =-1701
            BackColor =-2147483643
            ForeColor =-2147483640
        End
        Begin ComboBox
            SpecialEffect =2
            TextFontCharSet =204
            BorderLineStyle =0
            Width =1701
            LabelX =-1701
            BackColor =-2147483643
            ForeColor =-2147483640
        End
        Begin Subform
            SpecialEffect =2
            BorderLineStyle =0
            Width =1701
            Height =1701
        End
        Begin UnboundObjectFrame
            SpecialEffect =2
            OldBorderStyle =1
            Width =4536
            Height =2835
        End
        Begin ToggleButton
            TextFontCharSet =204
            Width =283
            Height =283
            FontSize =8
            FontWeight =400
            FontName ="MS Sans Serif"
            UnknownProp = {321 ,11 ,2 ,1 ,1 } Begin
                0x00
            End
        End
        Begin Tab
            TextFontCharSet =204
            BackStyle =0
            Width =5103
            Height =3402
            UnknownProp = {311 ,11 ,2 ,1 ,1 } Begin
                0x00
            End
        End
        Begin FormHeader
            Height =567
            BackColor =-2147483633
            Name ="ЗаголовокФормы"
            Tag ="BackColor=Dark"
            GUID = Begin
                0x360189fb98a7c246b0aac1d77060d266
            End
            Begin
                Begin Label
                    OverlapFlags =93
                    TextAlign =1
                    Left =60
                    Top =30
                    Width =861
                    Height =240
                    FontWeight =700
                    ForeColor =0
                    Name ="DibId_Надпись"
                    Caption ="DibId:"
                    Tag ="FontColor=White"
                    GUID = Begin
                        0xe50a9e24d4719345a2cd0058c041f634
                    End
                    UnknownProp = {298 ,622 ,4 ,0 ,4 } Begin
                        0x00000000
                    End
                End
                Begin Label
                    OverlapFlags =93
                    TextAlign =1
                    Left =2427
                    Top =30
                    Width =4320
                    Height =240
                    FontWeight =700
                    ForeColor =0
                    Name ="Comment_Надпись"
                    Caption ="Comment"
                    Tag ="FontColor=White"
                    GUID = Begin
                        0xd102b13ab8dadd4f92deed81568382bb
                    End
                    UnknownProp = {282 ,586 ,3 ,4 ,4 } Begin
                        0x7b090000
                    End
                    UnknownProp = {283 ,587 ,3 ,4 ,4 } Begin
                        0x1e000000
                    End
                    UnknownProp = {284 ,588 ,3 ,4 ,4 } Begin
                        0x5b1a0000
                    End
                    UnknownProp = {285 ,589 ,3 ,4 ,4 } Begin
                        0x0e010000
                    End
                    UnknownProp = {298 ,622 ,4 ,0 ,4 } Begin
                        0x00000000
                    End
                End
                Begin Label
                    Visible = NotDefault
                    OverlapFlags =223
                    TextAlign =1
                    Left =2418
                    Top =30
                    Width =2070
                    Height =240
                    FontWeight =700
                    ForeColor =0
                    Name ="Надпись18"
                    Caption ="StrId:"
                    Tag ="FontColor=White"
                    GUID = Begin
                        0x7507e6322077ba4481b9979ced4b9ad9
                    End
                    UnknownProp = {298 ,622 ,4 ,0 ,4 } Begin
                        0x00000000
                    End
                End
                Begin TextBox
                    AutoTab = NotDefault
                    OverlapFlags =95
                    TextAlign =3
                    FilterLookup =0
                    IMESentenceMode =3
                    Left =60
                    Top =270
                    Width =861
                    Height =255
                    ColumnOrder =0
                    Name ="txtDibIdFilter"
                    OnChange ="[Event Procedure]"
                    GUID = Begin
                        0x8fbd1cecd6d88a4082b03ce1cba101bb
                    End
                    UnknownProp = {299 ,0 ,3 ,4 ,4 } Begin
                        0xffffffff
                    End
                End
                Begin TextBox
                    AutoTab = NotDefault
                    OverlapFlags =95
                    FilterLookup =0
                    IMESentenceMode =3
                    Left =2427
                    Top =270
                    Width =4320
                    Height =255
                    ColumnOrder =1
                    TabIndex =1
                    Name ="txtCommentFilter"
                    FontName ="Arial"
                    OnChange ="[Event Procedure]"
                    GUID = Begin
                        0x6ac2b4d4a07c9c4692f503d9e36ed950
                    End
                    UnknownProp = {299 ,0 ,3 ,4 ,4 } Begin
                        0xffffffff
                    End
                    UnknownProp = {302 ,586 ,3 ,4 ,4 } Begin
                        0x7b090000
                    End
                    UnknownProp = {303 ,587 ,3 ,4 ,4 } Begin
                        0x0e010000
                    End
                    UnknownProp = {304 ,588 ,3 ,4 ,4 } Begin
                        0x5b1a0000
                    End
                    UnknownProp = {305 ,589 ,3 ,4 ,4 } Begin
                        0x0d020000
                    End
                End
                Begin Line
                    OverlapFlags =95
                    SpecialEffect =5
                    Left =30
                    Top =533
                    Width =6711
                    Name ="lin01"
                    GUID = Begin
                        0xdb3b6d53d7233342aa65fc9afd15addc
                    End
                End
                Begin TextBox
                    AutoTab = NotDefault
                    OverlapFlags =87
                    IMESentenceMode =3
                    Left =1290
                    Top =270
                    Width =1086
                    Height =255
                    ColumnOrder =2
                    TabIndex =2
                    Name ="txtCNameFilter"
                    FontName ="Arial"
                    OnChange ="[Event Procedure]"
                    GUID = Begin
                        0xf7375f879f457e4cb6285ba4bf3cd12b
                    End
                    UnknownProp = {299 ,0 ,3 ,4 ,4 } Begin
                        0xffffffff
                    End
                    Begin
                        Begin Label
                            OverlapFlags =93
                            TextAlign =1
                            Left =1290
                            Top =30
                            Width =1086
                            Height =240
                            FontWeight =700
                            ForeColor =0
                            Name ="Надпись25"
                            Caption ="CName"
                            Tag ="FontColor=White"
                            GUID = Begin
                                0x44c43b70fba5c844be47de2e9446baf5
                            End
                            UnknownProp = {298 ,622 ,4 ,0 ,4 } Begin
                                0x00000000
                            End
                        End
                    End
                End
            End
        End
        Begin Section
            Height =340
            BackColor =-2147483633
            Name ="ОбластьДанных"
            Tag ="BackColor=Light"
            GUID = Begin
                0x9785246ba62ff04dae371a4f72d4807c
            End
            Begin
                Begin TextBox
                    Visible = NotDefault
                    OverlapFlags =93
                    IMESentenceMode =3
                    Left =60
                    Width =861
                    Height =255
                    ColumnWidth =900
                    TabIndex =4
                    Name ="ColorId"
                    ControlSource ="=(Rnd()*16777215)\\1"
                    GUID = Begin
                        0xe82be582d8936b459fb2276b6dd999d9
                    End
                    UnknownProp = {299 ,0 ,3 ,4 ,4 } Begin
                        0xffffffff
                    End
                    UnknownProp = {302 ,586 ,3 ,4 ,4 } Begin
                        0x38000000
                    End
                    UnknownProp = {303 ,587 ,3 ,4 ,4 } Begin
                        0x1b010000
                    End
                    UnknownProp = {304 ,588 ,3 ,4 ,4 } Begin
                        0x95030000
                    End
                    UnknownProp = {305 ,589 ,3 ,4 ,4 } Begin
                        0x1a020000
                    End
                End
                Begin BoundObjectFrame
                    Enabled = NotDefault
                    Locked = NotDefault
                    TabStop = NotDefault
                    SizeMode =1
                    SpecialEffect =0
                    OverlapFlags =255
                    Width =6762
                    Height =340
                    TabIndex =5
                    Name ="oleColor"
                    ControlSource ="=OleObject_BackColor([ColorId])"
                    GUID = Begin
                        0x811866f5a5c96040946ed51ffd92923a
                    End
                    UnknownProp = {291 ,0 ,3 ,4 ,4 } Begin
                        0xffffffff
                    End
                    UnknownProp = {296 ,588 ,3 ,4 ,4 } Begin
                        0xe9130000
                    End
                    UnknownProp = {297 ,589 ,3 ,4 ,4 } Begin
                        0x37020000
                    End
                End
                Begin TextBox
                    OverlapFlags =247
                    IMESentenceMode =3
                    Left =60
                    Top =30
                    Width =861
                    ColumnWidth =1701
                    Name ="txtDibId"
                    ControlSource ="DibId"
                    GUID = Begin
                        0x8be656fb1e99c54193effa4680f70d34
                    End
                    UnknownProp = {299 ,0 ,3 ,4 ,4 } Begin
                        0xffffffff
                    End
                    UnknownProp = {302 ,586 ,3 ,4 ,4 } Begin
                        0x3c000000
                    End
                    UnknownProp = {303 ,587 ,3 ,4 ,4 } Begin
                        0x1e000000
                    End
                    UnknownProp = {304 ,588 ,3 ,4 ,4 } Begin
                        0x99030000
                    End
                    UnknownProp = {305 ,589 ,3 ,4 ,4 } Begin
                        0x0e010000
                    End
                End
                Begin TextBox
                    OverlapFlags =255
                    IMESentenceMode =3
                    Left =2427
                    Top =30
                    Width =4320
                    Height =255
                    TabIndex =3
                    Name ="txtComment"
                    ControlSource ="Comment"
                    GUID = Begin
                        0xcb49f47405db664abbe167b6078de5a9
                    End
                    UnknownProp = {299 ,0 ,3 ,4 ,4 } Begin
                        0xffffffff
                    End
                    UnknownProp = {302 ,586 ,3 ,4 ,4 } Begin
                        0x7b090000
                    End
                    UnknownProp = {303 ,587 ,3 ,4 ,4 } Begin
                        0x1e000000
                    End
                    UnknownProp = {304 ,588 ,3 ,4 ,4 } Begin
                        0x5b1a0000
                    End
                    UnknownProp = {305 ,589 ,3 ,4 ,4 } Begin
                        0x1d010000
                    End
                End
                Begin BoundObjectFrame
                    SpecialEffect =0
                    OverlapFlags =247
                    Left =960
                    Top =30
                    Width =284
                    Height =284
                    TabIndex =1
                    Name ="accOle"
                    ControlSource ="=OleObject_CreateFromDibId([txtDibId])"
                    GUID = Begin
                        0x5d72ef951361a649b3fe471426e6d216
                    End
                    UnknownProp = {291 ,0 ,3 ,4 ,4 } Begin
                        0xffffffff
                    End
                    UnknownProp = {294 ,586 ,3 ,4 ,4 } Begin
                        0xc3030000
                    End
                    UnknownProp = {296 ,588 ,3 ,4 ,4 } Begin
                        0xfa050000
                    End
                    UnknownProp = {297 ,589 ,3 ,4 ,4 } Begin
                        0x37020000
                    End
                End
                Begin ComboBox
                    Visible = NotDefault
                    OverlapFlags =247
                    TextAlign =1
                    IMESentenceMode =3
                    ColumnCount =2
                    Left =2415
                    Top =30
                    Width =2093
                    Height =255
                    TabIndex =2
                    GUID = Begin
                        0xbe313412ee621341ac9b3424401f2fbe
                    End
                    Name ="txtCodeName"
                    ControlSource ="StrId"
                    RowSourceType ="Table/Query"
                    ColumnWidths ="0"
                    UnknownProp = {306 ,0 ,3 ,4 ,4 } Begin
                        0xffffffff
                    End
                End
                Begin TextBox
                    OverlapFlags =247
                    IMESentenceMode =3
                    Left =1290
                    Top =30
                    Width =1086
                    Height =255
                    TabIndex =6
                    Name ="txtCName"
                    ControlSource ="CName"
                    GUID = Begin
                        0x0b98392dc00ddd4cbd7930a8d59eeeb4
                    End
                    UnknownProp = {299 ,0 ,3 ,4 ,4 } Begin
                        0xffffffff
                    End
                End
            End
        End
        Begin FormFooter
            Height =0
            BackColor =-2147483633
            Name ="ПримечаниеФормы"
            GUID = Begin
                0x23454efbcd4d0148bb50283ab2f8230f
            End
        End
    End
End
CodeBehindForm
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = True
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Compare Database
Option Explicit
'=========================
Private Const c_strModule As String = "Form_Test_OlePictDIBContinuos"
'=========================
' Описание      : Ленточная форма с DIB картинками
' Версия        : 1.0.0.452885137
' Дата          : 28.12.2023 12:19:44
' Автор         : Кашкин Р.В. (KashRus@gmail.com)
' Примечание    : выводит DIB иконки из Access в ленточную форму, также делает разноцветные строки
'=========================
#Const ObjectDataType = 0
' ObjectDataType = 0 - (x86/x64) использует библиотеки FreeImage             https://freeimage.sourceforge.io/download.html
'                для работы проект должен содержать модуль modFreeImage (адаптированный под x64 вариант Visual Basic Wrapper for FreeImage 3 by Carsten Klein (cklein05@users.sourceforge.net))
'                ВНИМАНИЕ!!! MSO 2003 (x86) вылетает на Load Library FreeImage.dll (v.3.18 x86), поэтому для x86 используем  FreeImage.dll (v.3.17 x86)
' ObjectDataType = 1 - (x86)     использует модифицированные классы LaVolpe  http://www.planet-source-code.com/vb/scripts/ShowCode.asp? txtCodeId=67466&lngWId=1

Const cMaxDibId = 10037 ' последний известный мне непустой DibId
' size convertion constants
Private Const PointsPerInch = 72
Private Const TwipsPerInch = 1440
Private Const CentimitersPerInch = 2.54                 '1 дюйм = 127 / 50 см
Private Const HimetricPerInch = 2540                    '1 дюйм = 1000 * 127/50 himetrix
'
Private Const inch = TwipsPerInch                       '1 дюйм = 1440 twips
Private Const pt = TwipsPerInch / PointsPerInch         '1 пункт = 20 twips
Private Const cm = TwipsPerInch / CentimitersPerInch    '1 см = 566.929133858 twips

Private Const cGap = 0.1 * cm
'' для групповой обработки событий контролов
'Private Const c_strAction1 = "Action1", c_strAction2 = "Action2"
'Private WithEvents mRelay As clsRelay   ' для ретрансляции событий группы контролов в форму
'Private colFloats As Collection         ' коллекция для хранения элементов clsFloatButton

#If ObjectDataType = 1 Then
Dim lvPict As clsPictureData
#End If

Private Sub Form_Open(Cancel As Integer)
    Me.Filter = vbNullString
    oleColor.SizeMode = acOLESizeStretch
'' форматирование формы
'    Call AccObjectSet(Me)
'' инициализация кнопок
'    Set colFloats = New Collection
'    Set mRelay = New clsRelay
'    p_InitFloats
End Sub
Private Sub Form_Close():   p_Erase: End Sub
Private Sub Form_Load():    p_ResizeControls: End Sub
Private Sub Form_Resize():  p_ResizeControls: End Sub
Private Sub Form_Current(): Call PictureData_SetIcon(Me.hwnd, "#" & DibId): End Sub

Private Sub Form_KeyDown(KeyCode As Integer, Shift As Integer)
    On Error GoTo HandleError
    Select Case KeyCode
    Case vbKeyDown: DoCmd.GoToRecord , , acNext
    Case vbKeyUp:   DoCmd.GoToRecord , , acPrevious
    End Select
HandleExit:  Exit Sub
HandleError: Err.Clear: Resume HandleExit
End Sub
Private Sub p_ResizeControls()
    On Error GoTo HandleError
Dim tmpWidth As Long: tmpWidth = InsideWidth - 255 'PixelsToTwips(pxScrBar)
    txtComment.Width = tmpWidth - txtComment.Left - txtComment.Height - cGap
    txtCommentFilter.Width = txtComment.Width
    lin01.Width = tmpWidth - 2 * lin01.Left
    oleColor.Width = tmpWidth
    Me.Width = tmpWidth
HandleExit:  Exit Sub
HandleError: Err.Clear: Resume HandleExit
End Sub
Private Function ButtonClick(DibId As Long)
    MsgBox ("Нажата иконка код #" & DibId)
End Function
Private Function OleObject_CreateFromDibId(DibId As Long)
' создает OLE Object Picture из DIB полученного по Id из Access
Dim Result As Long: Result = False
'-------------------------
' !!! только для экспериментов !!!
'-------------------------
' Картинки получаемые из Access по DibId 4 битные с 16 цветной палитрой
    On Error GoTo HandleError
'Dim aData() As Byte: Call ByteArray_ReadFromApp(DibId, aData) ' PictureData (DIB)
#If ObjectDataType = 0 Then
Dim fiPict As LongPtr: fiPict = PictureData_LoadFromEx(c_strAppDibIdPref & DibId)
    OleObject_CreateFromDibId = PictureData_CreateOleObject(fiPict, [ColorId])
#Else
    Set lvPict = PictureData_LoadFromEx(c_strAppDibIdPref & DibId)
    OleObject_CreateFromDibId = PictureData_CreateOleObject(lvPict, [ColorId])
#End If
HandleExit:  Exit Function
HandleError: Result = Err.Number: Err.Clear: Resume HandleExit
End Function
Private Sub txtCommentFilter_Change():  Call p_Filter_Change: End Sub
Private Sub txtDibIdFilter_Change():    Call p_Filter_Change: End Sub
Private Sub txtCNameFilter_Change():    Call p_Filter_Change: End Sub
Private Sub p_Filter_Change(Optional FilterControl)
' фильтр по акативному полю
    On Error GoTo HandleError
Const cOper = " AND ", cFunc = " LIKE "
    With ActiveControl
Dim lPos As Long: lPos = InStrRev(.Name, "Filter")
        If lPos > 0 Then
Dim lSelBeg As Long:    lSelBeg = .SelStart
Dim lSelLen As Long:    lSelLen = .SelLength
Dim sFilter As String:  sFilter = Me.Filter
Dim sField As String:   sField = "[" & Mid$(.Name, 4, lPos - 4) & "]"
            If Len(.Text) > 0 Then
                sFilter = TaggedStringSet(sFilter, sField, """*" & .Text & "*""", cOper, cFunc)
            Else
                sFilter = TaggedStringDel(sFilter, sField, cOper, cFunc)
            End If
            Me.Filter = sFilter
            If Len(sFilter) > 0 Then
                Me.FilterOn = True: .SetFocus
                .SelStart = lSelBeg: .SelLength = lSelLen
            Else
                Me.FilterOn = False: .SetFocus
            End If
        End If
        
    End With
HandleExit:  Exit Sub
HandleError: Err.Clear: Resume HandleExit
End Sub
Private Sub p_Erase()
On Error Resume Next
'    Set colFloats = Nothing: Set mRelay = Nothing
    Call SysCmd(acSysCmdSetStatus, vbNullString)
    Call PictureData_SetIcon(Me.hwnd)
End Sub
'Private Sub p_InitFloats()
'Dim i As Long ', iMax As Long
'Dim arrCtls() As String
'Dim ctl As Access.Control, cTransf As clsFloatButton
'Const cCols = 4     ' количество колонок в массиве
'Dim aFloats()       ' имя контрола | действие | картинка | подсказка
'    aFloats() = Array("txtCName", c_strAction1, c_strAppDibIdPref & 277, "Редактировать", _
'                      "txtComment", c_strAction2, c_strAppDibIdPref & 222, "Редактировать" _
'                      )
'    For i = LBound(aFloats) To UBound(aFloats) Step cCols
'        Set ctl = Me.Controls(Trim$(aFloats(i))) ' ControlName
'    ' создаем новый экземпляр класса
'        Set cTransf = New clsFloatButton
'        With cTransf
'            .Action = aFloats(i + 1)    '"MsgBox('Поле " & i & "')"
'            .Icon = aFloats(i + 2)      '
'            .Tooltip = aFloats(i + 3)   '
'    ' собственно инициализация
'            .Init Index:=i \ cCols, EventControl:=ctl, Relay:=mRelay
'        End With
'    ' сохраняем ссылку на объект класса,
'    ' чтобы обрабатывались события его встроенного объекта EventControl.
'        colFloats.Add cTransf
'    Next i
'End Sub
'Private Sub mRelay_GetParent(PARENT As Object): Set PARENT = Me: End Sub
'Public Sub FloatButton_Click( _
'    EventControl As Access.Control, Optional Action As String) 'As Integer
'' обрабатываем нажатие плавающей кнопки
'    Select Case Action
'    Case c_strAction1: MsgBox ("Выполнить действие 1" & vbCrLf & "для " & c_strAppDibIdPref & DibId)
'    Case c_strAction2: MsgBox ("Выполнить действие 2" & vbCrLf & "для " & c_strAppDibIdPref & DibId)
'    End Select
'End Sub